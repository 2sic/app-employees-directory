@inherits Custom.Hybrid.Razor12
@using ToSic.Razor.Blade;
@{
  // Activate turnOn in the page - see https://r.2sxc.org/turnon
  GetService<ToSic.Sxc.Web.IPageService>().Activate("turnOn");

  // They Google API key is in the App-Settings. See instructions: https://azing.org/2sxc/r/ippFQYkz
  // Get key from settings and remove empty lines. 
  var googleApikey = Settings.GoogleMapsKey.Replace("\n", "");

  // we need a unique ID for the map, in case there are many on the same page
  var mapId = CmsContext.Module.Id;

  // GPS is a JSON field, so we must use AsDynamic to easily access the properties
  var gps = AsDynamic(Content.GPS);

  var data = new {
    apiKey = googleApikey,
    domId = "GoogleMap-" + mapId,
    lat = gps.Latitude ?? 0,
    lng = gps.Longitude ?? 0, 
    warn = Convert.ToBool(Settings.GoogleMapsShowWarning, fallback: false),
    warning = "warning!"
  };
}

@* Instruct turnOn to activate GoogleMaps with the API key and everything once everything is loaded - uses turnOn https://r.2sxc.org/turnon *@
<turnOn turn-on='{ "run": "window.appPeopleDirectory4.activeGoogleMaps()", "data": @Html.Raw(Convert.Json.ToJson(data)) }'></turnOn>